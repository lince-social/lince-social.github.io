var Ue,j,at=/ðŸ–•JS_DSðŸš€/.source,je=at.slice(0,5),Ge=at.slice(4),q="datastar-fetch",Z="datastar-signal-patch",C=Object.hasOwn??Object.prototype.hasOwnProperty.call,U=e=>null!==e&&"object"==typeof e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e)),ct=e=>{for(let t in e)if(C(e,t))return!1;return!0},Y=(e,t)=>{for(let r in e){let n=e[r];U(n)||Array.isArray(n)?Y(n,t):e[r]=t(n)}},Me=e=>{let t={};for(let[r,n]of e){let e=r.split("."),l=e.pop();e.reduce(((e,t)=>e[t]??={}),t)[l]=n}return t},xe=[],Be=[],Oe=0,Le=0,We=0,Ne=0,M=()=>{Oe++},x=()=>{--Oe||(ft(),J())},F=e=>{Ue=j,j=e},P=()=>{j=Ue,Ue=void 0},pe=e=>Ut.bind(0,{previousValue:e,t:e,e:1}),Je=Symbol("computed"),ke=e=>{let t=Jt.bind(0,{e:17,getter:e});return t[Je]=1,t},S=e=>{let t={d:e,e:2};j&&ze(t,j),F(t),M();try{t.d()}finally{x(),P()}return gt.bind(0,t)},ft=()=>{for(;Le<We;){let e=Be[Le];Be[Le++]=void 0,pt(e,e.e&=-65)}Le=0,We=0},lt=e=>"getter"in e?dt(e):mt(e,e.t),dt=e=>{F(e),ht(e);try{let t=e.t;return t!==(e.t=e.getter(t))}finally{P(),yt(e)}},mt=(e,t)=>(e.e=1,e.previousValue!==(e.previousValue=t)),Ke=e=>{let t=e.e;if(!(64&t)){e.e=64|t;let r=e.r;r?Ke(r.o):Be[We++]=e}},pt=(e,t)=>{if(16&t||32&t&&bt(e.s,e)){F(e),ht(e),M();try{e.d()}finally{x(),P(),yt(e)}return}32&t&&(e.e=-33&t);let r=e.s;for(;r;){let e=r.c,t=e.e;64&t&&pt(e,e.e=-65&t),r=r.i}},Ut=(e,...t)=>{if(t.length){if(e.t!==(e.t=t[0])){e.e=17;let t=e.r;return t&&(Kt(t),Oe||ft()),!0}return!1}let r=e.t;if(16&e.e&&mt(e,r)){let t=e.r;t&&Pe(t)}return j&&ze(e,j),r},Jt=e=>{let t=e.e;if(16&t||32&t&&bt(e.s,e)){if(dt(e)){let t=e.r;t&&Pe(t)}}else 32&t&&(e.e=-33&t);return j&&ze(e,j),e.t},gt=e=>{let t=e.s;for(;t;)t=Fe(t,e);let r=e.r;r&&Fe(r),e.e=0},ze=(e,t)=>{let r=t.a;if(r&&r.c===e)return;let n=r?r.i:t.s;if(n&&n.c===e)return n.m=Ne,void(t.a=n);let l=e.p;if(l&&l.m===Ne&&l.o===t)return;let a=t.a=e.p={m:Ne,c:e,o:t,l:r,i:n,u:l};n&&(n.l=a),r?r.i=a:t.s=a,l?l.n=a:e.r=a},Fe=(e,t=e.o)=>{let r=e.c,n=e.l,l=e.i,a=e.n,i=e.u;if(l?l.l=n:t.a=n,n?n.i=l:t.s=l,a?a.u=i:r.p=i,i)i.n=a;else if(!(r.r=a))if("getter"in r){let e=r.s;if(e){r.e=17;do{e=Fe(e,r)}while(e)}}else"previousValue"in r||gt(r);return l},Kt=e=>{let t,r=e.n;e:for(;;){let n=e.o,l=n.e;if(60&l?12&l?4&l?48&l||!zt(e,n)?l=0:(n.e=40|l,l&=1):n.e=-9&l|32:l=0:n.e=32|l,2&l&&Ke(n),1&l){let l=n.r;if(l){let n=(e=l).n;n&&(t={t:r,f:t},r=n);continue}}if(!(e=r)){for(;t;)if(e=t.t,t=t.f,e){r=e.n;continue e}break}r=e.n}},ht=e=>{Ne++,e.a=void 0,e.e=-57&e.e|4},yt=e=>{let t=e.a,r=t?t.i:e.s;for(;r;)r=Fe(r,e);e.e&=-5},bt=(e,t)=>{let r,n=0,l=!1;e:for(;;){let a=e.c,i=a.e;if(16&t.e)l=!0;else if(17==(17&i)){if(lt(a)){let e=a.r;e.n&&Pe(e),l=!0}}else if(33==(33&i)){(e.n||e.u)&&(r={t:e,f:r}),e=a.s,t=a,++n;continue}if(!l){let t=e.i;if(t){e=t;continue}}for(;n--;){let n=t.r,a=n.n;if(a?(e=r.t,r=r.f):e=n,l){if(lt(t)){a&&Pe(n),t=e.o;continue}l=!1}else t.e&=-33;if(t=e.o,e.i){e=e.i;continue e}}return l}},Pe=e=>{do{let t=e.o,r=t.e;32==(48&r)&&(t.e=16|r,2&r&&Ke(t))}while(e=e.n)},zt=(e,t)=>{let r=t.a;for(;r;){if(r===e)return!0;r=r.l}return!1},oe=e=>{let t=X,r=e.split(".");for(let e of r){if(null==t||!C(t,e))return;t=t[e]}return t},Ce=(e,t="")=>{let r=Array.isArray(e);if(r||U(e)){let n=r?[]:{};for(let r in e)n[r]=pe(Ce(e[r],`${t+r}.`));let l=pe(0);return new Proxy(n,{get(e,a){if("toJSON"!==a||C(n,a))return r&&a in Array.prototype?(l(),n[a]):"symbol"==typeof a?n[a]:((!C(n,a)||null==n[a]())&&(n[a]=pe(""),J(t+a,""),l(l()+1)),n[a]())},set(e,a,i){let s=t+a;if(r&&"length"===a){let e=n[a]-i;if(n[a]=i,e>0){let e={};for(let t=i;t<n[a];t++)e[t]=null;J(t.slice(0,-1),e),l(l()+1)}}else if(C(n,a))if(null==i)delete n[a];else if(C(i,Je))n[a]=i,J(s,"");else{let e=n[a](),t=`${s}.`;if(U(e)&&U(i)){for(let r in e)C(i,r)||(delete e[r],J(t+r,null));for(let t in i){let r=i[t];e[t]!==r&&(e[t]=r)}}else n[a](Ce(i,t))&&J(s,i)}else null!=i&&(C(i,Je)?(n[a]=i,J(s,"")):(n[a]=pe(Ce(i,`${s}.`)),J(s,i)),l(l()+1));return!0},deleteProperty:(e,t)=>(delete n[t],l(l()+1),!0),ownKeys:()=>(l(),Reflect.ownKeys(n)),has:(e,t)=>(l(),t in n)})}return e},J=(e,t)=>{if(void 0!==e&&void 0!==t&&xe.push([e,t]),!Oe&&xe.length){let e=Me(xe);xe.length=0,document.dispatchEvent(new CustomEvent(Z,{detail:e}))}},O=(e,{ifMissing:t}={})=>{M();for(let r in e)null==e[r]?t||delete X[r]:vt(e[r],r,X,"",t);x()},T=(e,t)=>O(Me(e),t),vt=(e,t,r,n,l)=>{if(U(e)){C(r,t)&&(U(r[t])||Array.isArray(r[t]))||(r[t]={});for(let a in e)null==e[a]?l||delete r[t][a]:vt(e[a],a,r[t],`${n+t}.`,l)}else l&&C(r,t)||(r[t]=e)},ut=e=>"string"==typeof e?RegExp(e.replace(/^\/|\/$/g,"")):e,_=({include:e=/.*/,exclude:t=/(?!)/}={},r=X)=>{let n=ut(e),l=ut(t),a=[],i=[[r,""]];for(;i.length;){let[e,t]=i.pop();for(let r in e){let s=t+r;U(e[r])?i.push([e[r],`${s}.`]):n.test(s)&&!l.test(s)&&a.push([s,oe(s)])}}return Me(a)},X=Ce({}),K=e=>e instanceof HTMLElement||e instanceof SVGElement||e instanceof MathMLElement,ge=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").replace(/([a-z])([0-9]+)/gi,"$1-$2").replace(/([0-9]+)([a-z])/gi,"$1-$2").replace(/[\s_]+/g,"-").toLowerCase(),Et=e=>ge(e).replace(/-/g,"_"),ae=e=>{try{return JSON.parse(e)}catch{return Function(`return (${e})`)()}},St={camel:e=>e.replace(/-[a-z]/g,(e=>e[1].toUpperCase())),snake:e=>e.replace(/-/g,"_"),pascal:e=>e[0].toUpperCase()+St.camel(e.slice(1))},L=(e,t,r="camel")=>{for(let n of t.get("case")||[r])e=St[n]?.(e)||e;return e},G=e=>`data-${e}`,Qt="https://data-star.dev/errors",he=(e,t,r={})=>{Object.assign(r,e);let n=new Error,l=Et(t),a=new URLSearchParams({metadata:JSON.stringify(r)}).toString(),i=JSON.stringify(r,null,2);return n.message=`${t}\nMore info: ${Qt}/${l}?${a}\nContext: ${i}`,n},ye=new Map,Qe=new Map,At=new Map,Rt=new Proxy({},{get:(e,t)=>ye.get(t)?.apply,has:(e,t)=>ye.has(t),ownKeys:()=>Reflect.ownKeys(ye),set:()=>!1,deleteProperty:()=>!1}),be=new Map,He=[],Ze=new Set,Zt=new WeakSet,p=e=>{He.push(e),1===He.length&&setTimeout((()=>{for(let e of He)Ze.add(e.name),Qe.set(e.name,e);He.length=0,nn(),Ze.clear()}))},k=e=>{ye.set(e.name,e)};document.addEventListener(q,(e=>{let t=At.get(e.detail.type);t&&t.apply({error:he.bind(0,{plugin:{type:"watcher",name:t.name},element:{id:e.target.id,tag:e.target.tagName}})},e.detail.argsRaw)}));var ve=e=>{At.set(e.name,e)},Tt=e=>{for(let t of e){let e=be.get(t);if(e&&be.delete(t))for(let t of e.values())for(let e of t.values())e()}},wt=G("ignore"),Yt=`[${wt}]`,Mt=e=>e.hasAttribute(`${wt}__self`)||!!e.closest(Yt),_e=(e,t)=>{for(let r of e)if(!Mt(r))for(let e in r.dataset)xt(r,e.replace(/[A-Z]/g,"-$&").toLowerCase(),r.dataset[e],t)},Xt=e=>{for(let{target:t,type:r,attributeName:n,addedNodes:l,removedNodes:a}of e)if("childList"===r){for(let e of a)K(e)&&(Tt([e]),Tt(e.querySelectorAll("*")));for(let e of l)K(e)&&(_e([e]),_e(e.querySelectorAll("*")))}else if("attributes"===r&&n.startsWith("data-")&&K(t)&&!Mt(t)){let e=n.slice(5),r=t.getAttribute(n);if(null===r){let r=be.get(t);if(r){let t=r.get(e);if(t){for(let e of t.values())e();r.delete(e)}}}else xt(t,e,r)}},en=new MutationObserver(Xt),tn=e=>{let[t,...r]=e.split("__"),[n,l]=t.split(/:(.+)/),a=new Map;for(let e of r){let[t,...r]=e.split(".");a.set(t,new Set(r))}return{pluginName:n,key:l,mods:a}},nn=(e=document.documentElement,t=!0)=>{K(e)&&_e([e],!0),_e(e.querySelectorAll("*"),!0),t&&(en.observe(e,{subtree:!0,childList:!0,attributes:!0}),Zt.add(e))},xt=(e,t,r,n)=>{{let l=t,{pluginName:a,key:i,mods:s}=tn(l),o=Qe.get(a);if((!n||Ze.has(a))&&o){let t={el:e,rawKey:l,mods:s,error:he.bind(0,{plugin:{type:"attribute",name:o.name},element:{id:e.id,tag:e.tagName},expression:{rawKey:l,key:i,value:r}}),key:i,value:r,loadedPluginNames:{actions:new Set(ye.keys()),attributes:new Set(Qe.keys())},rx:void 0},n=o.requirement&&("string"==typeof o.requirement?o.requirement:o.requirement.key)||"allowed",a=o.requirement&&("string"==typeof o.requirement?o.requirement:o.requirement.value)||"allowed",u=null!=i&&""!==i,d=null!=r&&""!==r;if(u){if("denied"===n)throw t.error("KeyNotAllowed")}else if("must"===n)throw t.error("KeyRequired");if(d){if("denied"===a)throw t.error("ValueNotAllowed")}else if("must"===a)throw t.error("ValueRequired");if("exclusive"===n||"exclusive"===a){if(u&&d)throw t.error("KeyAndValueProvided");if(!u&&!d)throw t.error("KeyOrValueRequired")}let c=new Map;if(d){let n;t.rx=(...t)=>(n||(n=rn(r,{returnsValue:o.returnsValue,argNames:o.argNames,cleanups:c})),n(e,...t))}let f=o.apply(t);f&&c.set("attribute",f);let m=be.get(e);if(m){let e=m.get(l);if(e)for(let t of e.values())t()}else m=new Map,be.set(e,m);m.set(l,c)}}},rn=(e,{returnsValue:t=!1,argNames:r=[],cleanups:n=new Map}={})=>{let l="";if(t){let t=/(\/(\\\/|[^/])*\/|"(\\"|[^"])*"|'(\\'|[^'])*'|`(\\`|[^`])*`|\(\s*((function)\s*\(\s*\)|(\(\s*\))\s*=>)\s*(?:\{[\s\S]*?\}|[^;){]*)\s*\)\s*\(\s*\)|[^;])+/gm,r=e.trim().match(t);if(r){let e=r.length-1,t=r[e].trim();t.startsWith("return")||(r[e]=`return (${t});`),l=r.join(";\n")}}else l=e.trim();let a=new Map,i=RegExp(`(?:${je})(.*?)(?:${Ge})`,"gm"),s=0;for(let e of l.matchAll(i)){let t=e[1],r="__escaped"+s++;a.set(r,t),l=l.replace(je+t+Ge,r)}l=l.replace(/\$\['([a-zA-Z_$\d][\w$]*)'\]/g,"$$$1").replace(/\$([a-zA-Z_\d]\w*(?:[.-]\w+)*)/g,((e,t)=>t.split(".").reduce(((e,t)=>`${e}['${t}']`),"$"))),l=l.replaceAll(/@([A-Za-z_$][\w$]*)\(/g,'__action("$1",evt,');for(let[e,t]of a)l=l.replace(e,t);try{let t=Function("el","$","__action","evt",...r,l);return(r,...a)=>{let i=(t,a,...i)=>{let s=he.bind(0,{plugin:{type:"action",name:t},element:{id:r.id,tag:r.tagName},expression:{fnContent:l,value:e}}),o=Rt[t];if(o)return o({el:r,evt:a,error:s,cleanups:n},...i);throw s("UndefinedAction")};try{return t(r,X,i,void 0,...a)}catch(t){throw console.error(t),he({element:{id:r.id,tag:r.tagName},expression:{fnContent:l,value:e},error:t.message},"ExecuteExpression")}}}catch(t){throw console.error(t),he({expression:{fnContent:l,value:e},error:t.message},"GenerateExpression")}};k({name:"peek",apply(e,t){F();try{return t()}finally{P()}}}),k({name:"setAll",apply(e,t,r){F();let n=_(r);Y(n,(()=>t)),O(n),P()}}),k({name:"toggleAll",apply(e,t){F();let r=_(t);Y(r,(e=>!e)),O(r),P()}});var Ee=(e,t,r=!0)=>k({name:e,apply:async({el:n,evt:l,error:a,cleanups:i},s,{selector:o,headers:u,contentType:d="json",filterSignals:{include:c=/.*/,exclude:f=/(^|\.)_/}={},openWhenHidden:m=r,payload:p,requestCancellation:h="auto",retry:y="auto",retryInterval:g=1e3,retryScaler:v=2,retryMaxWaitMs:b=3e4,retryMaxCount:w=10}={})=>{let x=h instanceof AbortController?h:new AbortController;"auto"===h&&(i.get(`@${e}`)?.(),i.set(`@${e}`,(async()=>{x.abort(),await Promise.resolve()})));let S=null;try{if(!s?.length)throw a("FetchNoUrlProvided",{action:k});let e={Accept:"text/event-stream, text/html, application/json","Datastar-Request":!0};"json"===d&&(e["Content-Type"]="application/json");let r=Object.assign({},e,u),i={method:t,headers:r,openWhenHidden:m,retry:y,retryInterval:g,retryScaler:v,retryMaxWaitMs:b,retryMaxCount:w,signal:x.signal,onopen:async e=>{e.status>=400&&ee(sn,n,{status:e.status.toString()})},onmessage:e=>{if(!e.event.startsWith("datastar"))return;let t=e.event,r={};for(let t of e.data.split("\n")){let e=t.indexOf(" "),n=t.slice(0,e),l=t.slice(e+1);(r[n]||=[]).push(l)}let l=Object.fromEntries(Object.entries(r).map((([e,t])=>[e,t.join("\n")])));ee(t,n,l)},onerror:e=>{if(Lt(e))throw e("FetchExpectedTextEventStream",{url:s});e&&(console.error(e.message),ee(on,n,{message:e.message}))}},h=new URL(s,document.baseURI),E=new URLSearchParams(h.search);if("json"===d){F(),p=void 0!==p?p:_({include:c,exclude:f}),P();let e=JSON.stringify(p);"GET"===t?E.set("datastar",e):i.body=e}else{if("form"!==d)throw a("FetchInvalidContentType",{action:k,contentType:d});{let e=o?document.querySelector(o):n.closest("form");if(!e)throw a("FetchFormNotFound",{action:k,selector:o});if(!e.noValidate&&!e.checkValidity())return void e.reportValidity();let s=new FormData(e),u=n;if(n===e&&l instanceof SubmitEvent)u=l.submitter;else{let t=e=>e.preventDefault();e.addEventListener("submit",t),S=()=>{e.removeEventListener("submit",t)}}if(u instanceof HTMLButtonElement){let e=u.getAttribute("name");e&&s.append(e,u.value)}let d="multipart/form-data"===e.getAttribute("enctype");d||(r["Content-Type"]="application/x-www-form-urlencoded");let c=new URLSearchParams(s);if("GET"===t)for(let[e,t]of c)E.append(e,t);else i.body=d?s:c}}ee(Ye,n,{}),h.search=E.toString();try{await dn(h.toString(),n,i)}catch(e){if(!Lt(e))throw a("FetchFailed",{method:t,url:s,error:e.message})}}finally{ee(Xe,n,{}),S?.(),i.delete(`@${e}`)}}});Ee("get","GET",!1),Ee("patch","PATCH"),Ee("post","POST"),Ee("put","PUT"),Ee("delete","DELETE");var Ye="started",Xe="finished",sn="error",on="retrying",an="retries-failed",ee=(e,t,r)=>document.dispatchEvent(new CustomEvent(q,{detail:{type:e,el:t,argsRaw:r}})),Lt=e=>`${e}`.includes("text/event-stream"),cn=async(e,t)=>{let r=e.getReader(),n=await r.read();for(;!n.done;)t(n.value),n=await r.read()},ln=e=>{let t,r,n,l=!1;return a=>{t?t=fn(t,a):(t=a,r=0,n=-1);let i=t.length,s=0;for(;r<i;){l&&(10===t[r]&&(s=++r),l=!1);let a=-1;for(;r<i&&-1===a;++r)switch(t[r]){case 58:-1===n&&(n=r-s);break;case 13:l=!0;case 10:a=r}if(-1===a)break;e(t.subarray(s,a),n),s=r,n=-1}s===i?t=void 0:s&&(t=t.subarray(s),r-=s)}},un=(e,t,r)=>{let n=Nt(),l=new TextDecoder;return(a,i)=>{if(a.length){if(i>0){let r=l.decode(a.subarray(0,i)),s=i+(32===a[i+1]?2:1),o=l.decode(a.subarray(s));switch(r){case"data":n.data=n.data?`${n.data}\n${o}`:o;break;case"event":n.event=o;break;case"id":e(n.id=o);break;case"retry":{let e=+o;Number.isNaN(e)||t(n.retry=e);break}}}}else r?.(n),n=Nt()}},fn=(e,t)=>{let r=new Uint8Array(e.length+t.length);return r.set(e),r.set(t,e.length),r},Nt=()=>({data:"",event:"",id:"",retry:void 0}),dn=(e,t,{signal:r,headers:n,onopen:l,onmessage:a,onclose:i,onerror:s,openWhenHidden:o,fetch:u,retry:d="auto",retryInterval:c=1e3,retryScaler:f=2,retryMaxWaitMs:m=3e4,retryMaxCount:p=10,responseOverrides:h,...y})=>new Promise(((g,v)=>{let b,w={...n},x=()=>{b.abort(),document.hidden||L()};o||document.addEventListener("visibilitychange",x);let S,E=()=>{document.removeEventListener("visibilitychange",x),clearTimeout(S),b.abort()};r?.addEventListener("abort",(()=>{E(),g()}));let T=u||window.fetch,M=l||(()=>{}),k=0,A=c,L=async()=>{b=new AbortController;let r=b.signal;try{let n=await T(e,{...y,headers:w,signal:r});await M(n);let l=async(e,r,n,l,...a)=>{let i={[n]:await r.text()};for(let e of a){let t=r.headers.get(`datastar-${ge(e)}`);if(l){let r=l[e];r&&(t="string"==typeof r?r:JSON.stringify(r))}t&&(i[e]=t)}ee(e,t,i),E(),g()},s=n.status,o=204===s,u=s>=300&&s<400,f=s>=400&&s<600;if(200!==s)return i?.(),"never"===d||o||u||!("always"===d||"error"===d&&f)?(E(),void g()):(clearTimeout(S),void(S=setTimeout(L,c)));k=0,c=A;let m=n.headers.get("Content-Type");if(m?.includes("text/html"))return await l("datastar-patch-elements",n,"elements",h,"selector","mode","namespace","useViewTransition");if(m?.includes("application/json"))return await l("datastar-patch-signals",n,"signals",h,"onlyIfMissing");if(m?.includes("text/javascript")){let e=document.createElement("script"),t=n.headers.get("datastar-script-attributes");if(t)for(let[r,n]of Object.entries(JSON.parse(t)))e.setAttribute(r,n);return e.textContent=await n.text(),document.head.appendChild(e),void E()}if(await cn(n.body,ln(un((e=>{e?w["last-event-id"]=e:delete w["last-event-id"]}),(e=>{A=c=e}),a))),i?.(),"always"===d&&!u)return clearTimeout(S),void(S=setTimeout(L,c));E(),g()}catch(n){if(!r.aborted)try{let r=s?.(n)||c;clearTimeout(S),S=setTimeout(L,r),c=Math.min(c*f,m),++k>=p?(ee(an,t,{}),E(),v("Max retries reached.")):console.error(`Datastar failed to reach ${e.toString()} retrying in ${r}ms.`)}catch(e){E(),v(e)}}};L()}));p({name:"attr",requirement:{value:"must"},returnsValue:!0,apply({el:e,key:t,rx:r}){let n=(t,r)=>{""===r||!0===r?e.setAttribute(t,""):!1===r||null==r?e.removeAttribute(t):"string"==typeof r?e.setAttribute(t,r):e.setAttribute(t,JSON.stringify(r))},l=t?()=>{a.disconnect();let l=r();n(t,l),a.observe(e,{attributeFilter:[t]})}:()=>{a.disconnect();let t=r(),l=Object.keys(t);for(let e of l)n(e,t[e]);a.observe(e,{attributeFilter:l})},a=new MutationObserver(l),i=S(l);return()=>{a.disconnect(),i()}}});var mn=/^data:(?<mime>[^;]+);base64,(?<contents>.*)$/,Ct=Symbol("empty"),Ft=G("bind");p({name:"bind",requirement:"exclusive",apply({el:e,key:t,mods:r,value:n,error:l}){let a=null!=t?L(t,r):n,i=(e,t)=>"number"===t?+e.value:e.value,s=t=>{e.value=`${t}`};if(e instanceof HTMLInputElement)switch(e.type){case"range":case"number":i=(e,t)=>"string"===t?e.value:+e.value;break;case"checkbox":i=(e,t)=>"on"!==e.value?"boolean"===t?e.checked:e.checked?e.value:"":"string"===t?e.checked?e.value:"":e.checked,s=t=>{e.checked="string"==typeof t?t===e.value:t};break;case"radio":e.getAttribute("name")?.length||e.setAttribute("name",a),i=(e,t)=>e.checked?"number"===t?+e.value:e.value:Ct,s=t=>{e.checked=t===("number"==typeof t?+e.value:e.value)};break;case"file":{let t=()=>{let t=[...e.files||[]],r=[];Promise.all(t.map((e=>new Promise((t=>{let n=new FileReader;n.onload=()=>{if("string"!=typeof n.result)throw l("InvalidFileResultType",{resultType:typeof n.result});let t=n.result.match(mn);if(!t?.groups)throw l("InvalidDataUri",{result:n.result});r.push({name:e.name,contents:t.groups.contents,mime:t.groups.mime})},n.onloadend=()=>t(),n.readAsDataURL(e)}))))).then((()=>{T([[a,r]])}))};return e.addEventListener("change",t),e.addEventListener("input",t),()=>{e.removeEventListener("change",t),e.removeEventListener("input",t)}}}else if(e instanceof HTMLSelectElement){if(e.multiple){let t=new Map;i=e=>[...e.selectedOptions].map((e=>{let r=t.get(e.value);return"string"===r||null==r?e.value:+e.value})),s=r=>{for(let n of e.options)r.includes(n.value)?(t.set(n.value,"string"),n.selected=!0):r.includes(+n.value)?(t.set(n.value,"number"),n.selected=!0):n.selected=!1}}}else e instanceof HTMLTextAreaElement||(i=e=>"value"in e?e.value:e.getAttribute("value"),s=t=>{"value"in e?e.value=t:e.setAttribute("value",t)});let o=oe(a),u=typeof o,d=a;if(!Array.isArray(o)||e instanceof HTMLSelectElement&&e.multiple)T([[d,i(e,u)]],{ifMissing:!0});else{let r=t||n,l=document.querySelectorAll(`[${Ft}\\:${CSS.escape(r)}],[${Ft}="${CSS.escape(r)}"]`),a=[],s=0;for(let t of l){if(a.push([`${d}.${s}`,i(t,"none")]),e===t)break;s++}T(a,{ifMissing:!0}),d=`${d}.${s}`}let c=()=>{let t=oe(d);if(null!=t){let r=i(e,typeof t);r!==Ct&&T([[d,r]])}};e.addEventListener("input",c),e.addEventListener("change",c);let f=S((()=>{s(oe(d))}));return()=>{f(),e.removeEventListener("input",c),e.removeEventListener("change",c)}}}),p({name:"class",requirement:{value:"must"},returnsValue:!0,apply({key:e,el:t,mods:r,rx:n}){e&&=L(e,r,"kebab");let l,a=()=>{i.disconnect(),l=e?{[e]:n()}:n();for(let e in l){let r=e.split(/\s+/).filter((e=>e.length>0));if(l[e])for(let e of r)t.classList.contains(e)||t.classList.add(e);else for(let e of r)t.classList.contains(e)&&t.classList.remove(e)}i.observe(t,{attributeFilter:["class"]})},i=new MutationObserver(a),s=S(a);return()=>{i.disconnect(),s();for(let e in l){let r=e.split(/\s+/).filter((e=>e.length>0));for(let e of r)t.classList.remove(e)}}}}),p({name:"computed",requirement:{value:"must"},returnsValue:!0,apply({key:e,mods:t,rx:r,error:n}){if(e)T([[L(e,t),ke(r)]]);else{let e=Object.assign({},r());Y(e,(e=>{if("function"==typeof e)return ke(e);throw n("ComputedExpectedFunction")})),O(e)}}}),p({name:"effect",requirement:{key:"denied",value:"must"},apply:({rx:e})=>S(e)}),p({name:"indicator",requirement:"exclusive",apply({el:e,key:t,mods:r,value:n}){let l=null!=t?L(t,r):n;T([[l,!1]]);let a=t=>{let{type:r,el:n}=t.detail;if(n===e)switch(r){case Ye:T([[l,!0]]);break;case Xe:T([[l,!1]])}};return document.addEventListener(q,a),()=>{T([[l,!1]]),document.removeEventListener(q,a)}}});var z=e=>{if(!e||e.size<=0)return 0;for(let t of e){if(t.endsWith("ms"))return+t.replace("ms","");if(t.endsWith("s"))return 1e3*+t.replace("s","");try{return Number.parseFloat(t)}catch{}}return 0},te=(e,t,r=!1)=>e?e.has(t.toLowerCase()):r,et=(e,t)=>(...r)=>{setTimeout((()=>{e(...r)}),t)},Pt=(e,t,r=!0,n=!1,l=!1)=>{let a=null,i=0;return(...s)=>{r&&!i?(e(...s),a=null):a=s,(!i||l)&&(i&&clearTimeout(i),i=setTimeout((()=>{n&&null!==a&&e(...a),a=null,i=0}),t))}},ce=(e,t)=>{let r=t.get("delay");if(r){let t=z(r);e=et(e,t)}let n=t.get("debounce");if(n){let t=z(n),r=te(n,"leading",!1),l=!te(n,"notrailing",!1);e=Pt(e,t,r,l,!0)}let l=t.get("throttle");if(l){let t=z(l),r=!te(l,"noleading",!1),n=te(l,"trailing",!1);e=Pt(e,t,r,n)}return e},tt=!!document.startViewTransition,Q=(e,t)=>{if(t.has("viewtransition")&&tt){let t=e;e=(...e)=>document.startViewTransition((()=>t(...e)))}return e};p({name:"init",requirement:{key:"denied",value:"must"},apply({rx:e,mods:t}){let r=()=>{M(),e(),x()};r=Q(r,t);let n=0,l=t.get("delay");l&&(n=z(l),n>0&&(r=et(r,n))),r()}}),p({name:"json-signals",requirement:{key:"denied"},apply({el:e,value:t,mods:r}){let n=r.has("terse")?0:2,l={};t&&(l=ae(t));let a=()=>{i.disconnect(),e.textContent=JSON.stringify(_(l),null,n),i.observe(e,{childList:!0,characterData:!0,subtree:!0})},i=new MutationObserver(a),s=S(a);return()=>{i.disconnect(),s()}}}),p({name:"on",requirement:"must",argNames:["evt"],apply({el:e,key:t,mods:r,rx:n}){let l=e;r.has("window")&&(l=window);let a=e=>{e&&(r.has("prevent")&&e.preventDefault(),r.has("stop")&&e.stopPropagation()),M(),n(e),x()};a=Q(a,r),a=ce(a,r);let i={capture:r.has("capture"),passive:r.has("passive"),once:r.has("once")};if(r.has("outside")){l=document;let t=a;a=r=>{e.contains(r?.target)||t(r)}}let s=L(t,r,"kebab");if((s===q||s===Z)&&(l=document),e instanceof HTMLFormElement&&"submit"===s){let e=a;a=t=>{t?.preventDefault(),e(t)}}return l.addEventListener(s,a,i),()=>{l.removeEventListener(s,a)}}});var Ot=(e,t,r)=>Math.max(t,Math.min(r,e)),nt=new WeakSet;p({name:"on-intersect",requirement:{key:"denied",value:"must"},apply({el:e,mods:t,rx:r}){let n=()=>{M(),r(),x()};n=Q(n,t),n=ce(n,t);let l={threshold:0};t.has("full")?l.threshold=1:t.has("half")?l.threshold=.5:t.get("threshold")&&(l.threshold=Ot(Number(t.get("threshold")),0,100)/100);let a=t.has("exit"),i=new IntersectionObserver((t=>{for(let r of t)r.isIntersecting!==a&&(n(),i&&nt.has(e)&&i.disconnect())}),l);return i.observe(e),t.has("once")&&nt.add(e),()=>{t.has("once")||nt.delete(e),i&&(i.disconnect(),i=null)}}}),p({name:"on-interval",requirement:{key:"denied",value:"must"},apply({mods:e,rx:t}){let r=()=>{M(),t(),x()};r=Q(r,e);let n=1e3,l=e.get("duration");l&&(n=z(l),te(l,"leading",!1)&&r());let a=setInterval(r,n);return()=>{clearInterval(a)}}}),p({name:"on-signal-patch",requirement:{value:"must"},argNames:["patch"],returnsValue:!0,apply({el:e,key:t,mods:r,rx:n,error:l}){if(t&&"filter"!==t)throw l("KeyNotAllowed");let a=G(`${this.name}-filter`),i=e.getAttribute(a),s={};i&&(s=ae(i));let o=!1,u=ce((e=>{if(o)return;let t=_(s,e.detail);if(!ct(t)){o=!0,M();try{n(t)}finally{x(),o=!1}}}),r);return document.addEventListener(Z,u),()=>{document.removeEventListener(Z,u)}}}),p({name:"ref",requirement:"exclusive",apply({el:e,key:t,mods:r,value:n}){let l=null!=t?L(t,r):n;T([[l,e]])}});var kt="none",Ht="display";p({name:"show",requirement:{key:"denied",value:"must"},returnsValue:!0,apply({el:e,rx:t}){let r=()=>{n.disconnect(),t()?e.style.display===kt&&e.style.removeProperty(Ht):e.style.setProperty(Ht,kt),n.observe(e,{attributeFilter:["style"]})},n=new MutationObserver(r),l=S(r);return()=>{n.disconnect(),l()}}}),p({name:"signals",returnsValue:!0,apply({key:e,mods:t,rx:r}){let n=t.has("ifmissing");if(e)e=L(e,t),T([[e,r?.()]],{ifMissing:n});else{let e=Object.assign({},r?.());O(e,{ifMissing:n})}}}),p({name:"style",requirement:{value:"must"},returnsValue:!0,apply({key:e,el:t,rx:r}){let{style:n}=t,l=new Map,a=(e,t)=>{let r=l.get(e);t||0===t?(void 0===r&&l.set(e,n.getPropertyValue(e)),n.setProperty(e,String(t))):void 0!==r&&(r?n.setProperty(e,r):n.removeProperty(e))},i=()=>{if(s.disconnect(),e)a(e,r());else{let e=r();for(let[t,r]of l)t in e||(r?n.setProperty(t,r):n.removeProperty(t));for(let t in e)a(ge(t),e[t])}s.observe(t,{attributeFilter:["style"]})},s=new MutationObserver(i),o=S(i);return()=>{s.disconnect(),o();for(let[e,t]of l)t?n.setProperty(e,t):n.removeProperty(e)}}}),p({name:"text",requirement:{key:"denied",value:"must"},returnsValue:!0,apply({el:e,rx:t}){let r=()=>{n.disconnect(),e.textContent=`${t()}`,n.observe(e,{childList:!0,characterData:!0,subtree:!0})},n=new MutationObserver(r),l=S(r);return()=>{n.disconnect(),l()}}});var _t=(e,t)=>e.includes(t),pn=["remove","outer","inner","replace","prepend","append","before","after"],gn=["html","svg","mathml"];ve({name:"datastar-patch-elements",apply(e,{selector:t="",mode:r="outer",namespace:n="html",useViewTransition:l="",elements:a=""}){if(!_t(pn,r))throw e.error("PatchElementsInvalidMode",{mode:r});if(!t&&"outer"!==r&&"replace"!==r)throw e.error("PatchElementsExpectedSelector");if(!_t(gn,n))throw e.error("PatchElementsInvalidNamespace",{namespace:n});let i={selector:t,mode:r,namespace:n,useViewTransition:"true"===l.trim(),elements:a};tt&&l?document.startViewTransition((()=>Dt(e,i))):Dt(e,i)}});var Dt=({error:e},{selector:t,mode:r,namespace:n,elements:l})=>{let a=l.replace(/<svg(\s[^>]*>|>)([\s\S]*?)<\/svg>/gim,""),i=/<\/html>/.test(a),s=/<\/head>/.test(a),o=/<\/body>/.test(a),u="svg"===n?"svg":"mathml"===n?"math":"",d=u?`<${u}>${l}</${u}>`:l,c=(new DOMParser).parseFromString(i||s||o?l:`<body><template>${d}</template></body>`,"text/html"),f=document.createDocumentFragment();if(i)f.appendChild(c.documentElement);else if(s&&o)f.appendChild(c.head),f.appendChild(c.body);else if(s)f.appendChild(c.head);else if(o)f.appendChild(c.body);else if(u){let e=c.querySelector("template").content.querySelector(u);for(let t of e.childNodes)f.appendChild(t)}else f=c.querySelector("template").content;if(t||"outer"!==r&&"replace"!==r){let n=document.querySelectorAll(t);if(!n.length)return void console.warn(e("PatchElementsNoTargetsFound"),{selector:t});$t(r,f,n)}else for(let t of f.children){let n;if(t instanceof HTMLHtmlElement)n=document.documentElement;else if(t instanceof HTMLBodyElement)n=document.body;else if(t instanceof HTMLHeadElement)n=document.head;else if(n=document.getElementById(t.id),!n){console.warn(e("PatchElementsNoTargetsFound"),{element:{id:t.id}});continue}$t(r,t,[n])}},st=new WeakSet;for(let e of document.querySelectorAll("script"))st.add(e);var jt=e=>{let t=e instanceof HTMLScriptElement?[e]:e.querySelectorAll("script");for(let e of t)if(!st.has(e)){let t=document.createElement("script");for(let{name:r,value:n}of e.attributes)t.setAttribute(r,n);t.text=e.text,e.replaceWith(t),st.add(t)}},Vt=(e,t,r)=>{for(let n of e){let e=t.cloneNode(!0);jt(e),n[r](e)}},$t=(e,t,r)=>{switch(e){case"remove":for(let e of r)e.remove();break;case"outer":case"inner":for(let n of r)yn(n,t.cloneNode(!0),e),jt(n);break;case"replace":Vt(r,t,"replaceWith");break;case"prepend":case"append":case"before":case"after":Vt(r,t,e)}},H=new Map,ue=new Set,le=new Map,Se=new Set,fe=document.createElement("div");fe.hidden=!0;var Te=G("ignore-morph"),hn=`[${Te}]`,yn=(e,t,r="outer")=>{if(K(e)&&K(t)&&e.hasAttribute(Te)&&t.hasAttribute(Te)||e.parentElement?.closest(hn))return;let n=document.createElement("div");n.append(t),document.body.insertAdjacentElement("afterend",fe);let l=e.querySelectorAll("[id]");for(let{id:e,tagName:t}of l)le.has(e)?Se.add(e):le.set(e,t);e instanceof Element&&e.id&&(le.has(e.id)?Se.add(e.id):le.set(e.id,e.tagName)),ue.clear();let a=n.querySelectorAll("[id]");for(let{id:e,tagName:t}of a)ue.has(e)?Se.add(e):le.get(e)===t&&ue.add(e);for(let e of Se)ue.delete(e);le.clear(),Se.clear(),H.clear();let i="outer"===r?e.parentElement:e;qt(i,l),qt(n,a),Gt(i,n,"outer"===r?e:null,e.nextSibling),fe.remove()},Gt=(e,t,r=null,n=null)=>{e instanceof HTMLTemplateElement&&t instanceof HTMLTemplateElement&&(e=e.content,t=t.content),r??=e.firstChild;for(let l of t.childNodes){if(r&&r!==n){let e=bn(l,r,n);if(e){if(e!==r){let t=r;for(;t&&t!==e;){let e=t;t=t.nextSibling,it(e)}}rt(e,l),r=e.nextSibling;continue}}if(l instanceof Element&&ue.has(l.id)){let t=document.getElementById(l.id),n=t;for(;n=n.parentNode;){let e=H.get(n);e&&(e.delete(l.id),e.size||H.delete(n))}Bt(e,t,r),rt(t,l),r=t.nextSibling}else if(H.has(l)){let t=l.namespaceURI,n=l.tagName,a=t&&"http://www.w3.org/1999/xhtml"!==t?document.createElementNS(t,n):document.createElement(n);e.insertBefore(a,r),rt(a,l),r=a.nextSibling}else{let t=document.importNode(l,!0);e.insertBefore(t,r),r=t.nextSibling}}for(;r&&r!==n;){let e=r;r=r.nextSibling,it(e)}},bn=(e,t,r)=>{let n=null,l=e.nextSibling,a=0,i=0,s=H.get(e)?.size||0,o=t;for(;o&&o!==r;){if(It(o,e)){let t=!1,r=H.get(o),l=H.get(e);if(l&&r)for(let e of r)if(l.has(e)){t=!0;break}if(t)return o;if(!n&&!H.has(o)){if(!s)return o;n=o}}if(i+=H.get(o)?.size||0,i>s)break;null===n&&l&&It(o,l)&&(a++,l=l.nextSibling,a>=2&&(n=void 0)),o=o.nextSibling}return n||null},It=(e,t)=>e.nodeType===t.nodeType&&e.tagName===t.tagName&&(!e.id||e.id===t.id),it=e=>{H.has(e)?Bt(fe,e,null):e.parentNode?.removeChild(e)},Bt=it.call.bind(fe.moveBefore??fe.insertBefore),vn=G("preserve-attr"),rt=(e,t)=>{let r=t.nodeType;if(1===r){let r=e,n=t,l=r.hasAttribute("data-scope-children");if(r.hasAttribute(Te)&&n.hasAttribute(Te))return e;r instanceof HTMLInputElement&&n instanceof HTMLInputElement&&"file"!==n.type?n.getAttribute("value")!==r.getAttribute("value")&&(r.value=n.getAttribute("value")??""):r instanceof HTMLTextAreaElement&&n instanceof HTMLTextAreaElement&&(n.value!==r.value&&(r.value=n.value),r.firstChild&&r.firstChild.nodeValue!==n.value&&(r.firstChild.nodeValue=n.value));let a=(t.getAttribute(vn)??"").split(" ");for(let{name:e,value:t}of n.attributes)r.getAttribute(e)!==t&&!a.includes(e)&&r.setAttribute(e,t);for(let e=r.attributes.length-1;e>=0;e--){let{name:t}=r.attributes[e];!n.hasAttribute(t)&&!a.includes(t)&&r.removeAttribute(t)}l&&!r.hasAttribute("data-scope-children")&&r.setAttribute("data-scope-children",""),r.isEqualNode(n)||Gt(r,n),l&&r.dispatchEvent(new CustomEvent("datastar:scope-children",{bubbles:!1}))}return(8===r||3===r)&&e.nodeValue!==t.nodeValue&&(e.nodeValue=t.nodeValue),e},qt=(e,t)=>{for(let r of t)if(ue.has(r.id)){let t=r;for(;t&&t!==e;){let e=H.get(t);e||(e=new Set,H.set(t,e)),e.add(r.id),t=t.parentElement}}};ve({name:"datastar-patch-signals",apply({error:e},{signals:t,onlyIfMissing:r}){if(!t)throw e("PatchSignalsExpectedSignals");{let e="true"===r?.trim();O(ae(t),{ifMissing:e})}}});export{k as action,Rt as actions,p as attribute,M as beginBatch,ke as computed,S as effect,x as endBatch,_ as filtered,oe as getPath,O as mergePatch,T as mergePaths,X as root,pe as signal,F as startPeeking,P as stopPeeking,ve as watcher};
